# Vite Plugin - Tailwind Theme Resolver

Auto-generates TypeScript types and runtime theme objects from your Tailwind CSS v4 theme files. Types regenerate automatically on file changes with HMR support.

## Installation

```bash
npm install -D tailwind-resolver
# or
bun add -D tailwind-resolver
```

## Setup

Add the plugin to your `vite.config.ts`:

```typescript
import { tailwindResolver } from 'tailwind-resolver/vite';
import { defineConfig } from 'vite';

export default defineConfig({
  plugins: [
    tailwindResolver({
      input: 'src/styles.css',
    }),
  ],
});
```

**Version-specific import** (lock to v4):

```typescript
import { tailwindResolver } from 'tailwind-resolver/v4/vite';
```

## Generated Files

The plugin generates files in your specified `outputDir`.

**Default output directory:**

- `src/generated/tailwindcss/` if your project has a `src/` folder
- `generated/tailwindcss/` otherwise

### `themes.d.ts` (Always Generated)

TypeScript type declarations for your theme:

```typescript
/**
 * ⚠️ AUTO-GENERATED FILE - DO NOT EDIT MANUALLY
 */

export interface GeneratedTheme {
  colors: {
    primary: { 500: 'oklch(0.65 0.20 250)' };
    background: '#ffffff';
  };
  fontSize: {
    xl: { size: '1.25rem'; lineHeight: '1.75rem' };
  };
  // ... all other namespaces
}

// Augments the runtime API types
declare module 'tailwind-resolver' {
  interface Theme extends GeneratedTheme {}
}

// Export declarations for runtime objects (if generateRuntime: true)
export declare const base: GeneratedTheme;
export declare const dark: Partial<GeneratedTheme>;
export declare const selectors: { dark: string };
```

### `themes.ts` (Generated by Default)

Runtime theme objects for immediate use (opt-out with `generateRuntime: false`):

```typescript
/**
 * ⚠️ AUTO-GENERATED FILE - DO NOT EDIT MANUALLY
 */

export const base = {
  colors: {
    primary: { 500: 'oklch(0.65 0.20 250)' },
    background: '#ffffff',
  },
  fontSize: {
    xl: { size: '1.25rem', lineHeight: '1.75rem' },
  },
  // ... complete base theme
} as const;

export const dark = {
  colors: { background: '#1f2937' },
  // ... only overridden values for dark variant
} as const;

export const selectors = {
  dark: "[data-theme='dark']",
} as const;

export default base;
```

## Plugin Options

```typescript
interface VitePluginOptions {
  /**
   * Path to your CSS input file (relative to Vite project root)
   * @required
   */
  input: string;

  /**
   * Output directory for generated files (relative to Vite project root)
   * Auto-detects: 'src/generated/tailwindcss' if src/ exists, otherwise 'generated/tailwindcss'
   */
  outputDir?: string;

  /**
   * Resolve @import statements recursively
   * @default true
   */
  resolveImports?: boolean;

  /**
   * Control what gets generated in the runtime file
   * - false: No runtime file (types only)
   * - true: Generate all runtime data (variants, selectors, excluding debug data)
   * - object: Granular control over what to include
   * @default true
   */
  generateRuntime?:
    | boolean
    | {
        variants?: boolean; // Theme variants (default: true)
        selectors?: boolean; // CSS selectors (default: true)
        files?: boolean; // Processed files (default: false)
        variables?: boolean; // Raw variables (default: false)
      };

  /**
   * Include Tailwind CSS defaults from node_modules
   * @default true
   */
  includeTailwindDefaults?: boolean;

  /**
   * Enable debug logging for troubleshooting
   * @default false
   */
  debug?: boolean;
}
```

## Usage Examples

### Chart.js Integration

```typescript
import { Chart } from 'chart.js';

import { base } from './generated/tailwindcss/themes';

new Chart(ctx, {
  type: 'bar',
  data: {
    datasets: [
      {
        backgroundColor: [
          base.colors.primary[500],
          base.colors.secondary[500],
          base.colors.tertiary[500],
        ],
      },
    ],
  },
});
```

### Dynamic Theme Switching

```typescript
import { base, dark, selectors } from './generated/tailwindcss/themes';

function applyTheme(mode: 'light' | 'dark') {
  const theme = mode === 'light' ? base : dark;

  // Apply CSS selector
  document.documentElement.setAttribute('data-theme', mode);

  // Update chart colors
  chartInstance.data.datasets[0].backgroundColor = theme.colors.primary[500];
  chartInstance.update();
}
```

### Canvas Rendering

```typescript
import { base } from './generated/tailwindcss/themes';

function drawText(ctx: CanvasRenderingContext2D) {
  ctx.fillStyle = base.colors.foreground;
  ctx.font = `${base.fontSize.xl.size} ${base.fonts.display}`;
  ctx.fillText('Hello World', 10, 50);
}
```

### React Component

```typescript
import { base, dark } from './generated/tailwindcss/themes';

function ThemedComponent() {
  const [mode, setMode] = useState<'light' | 'dark'>('light');
  const theme = mode === 'light' ? base : dark;

  return (
    <div style={{ backgroundColor: theme.colors.background }}>
      <canvas ref={(el) => el && drawChart(el, theme)} />
    </div>
  );
}
```

## Features

### Automatic Regeneration

The plugin watches your CSS files and regenerates types on every change:

```css
/* src/styles.css */
@theme {
  --color-brand: #3b82f6;
}
```

**Save the file** → Types regenerate automatically → Autocomplete updates immediately

### Multi-File Support

Automatically tracks all imported CSS files:

```css
/* src/styles.css */
@import './colors.css';
@import './typography.css';

@theme {
  /* Additional variables */
}
```

Changes to any imported file trigger regeneration.

### Theme Variants

Resolves dark mode and custom theme variants:

```css
@theme {
  --color-background: #ffffff;
}

[data-theme='dark'] {
  --color-background: #1f2937;
}

.midnight {
  --color-background: #0f172a;
}
```

**Generated exports:**

```typescript
export const base = { colors: { background: '#ffffff' } };
export const dark = { colors: { background: '#1f2937' } };
export const midnight = { colors: { background: '#0f172a' } };

export const selectors = {
  dark: "[data-theme='dark']",
  midnight: '.midnight',
};
```

## TypeScript Configuration

Ensure generated files are included in `tsconfig.json`:

```json
{
  "include": ["src/**/*"],
  "compilerOptions": {
    "skipLibCheck": true
  }
}
```

## Git Configuration

You can choose to commit or ignore the generated files:

```gitignore
# Option 1: Ignore generated files (regenerates on each machine)
src/generated/

# Option 2: Commit generated files (available immediately after clone)
# (Recommended for teams - similar to Prisma Client)
```

## Troubleshooting

### Types Not Updating

1. Save the CSS file to trigger regeneration
2. Verify `input` points to the correct file
3. Check Vite console for error messages
4. Restart TypeScript server (VS Code: `Cmd+Shift+P` → "Restart TS Server")

### Import Errors

```
Cannot find module './generated/tailwindcss/themes'
```

**Solutions:**

1. Runtime generation is enabled by default - check the plugin logs
2. Start the dev server at least once to generate files
3. Check that `outputDir` exists in your `tsconfig.json` include paths
4. Verify the generated files exist in the file system
5. Set `generateRuntime: false` if you only need type declarations

### HMR Not Working

The plugin logs theme updates to the console:

```
  ℹ  Tailwind theme updated from styles.css
```

If you don't see this message:

1. Verify the CSS file is being watched by Vite
2. Check that the file is inside your project root
3. Ensure `resolveImports: true` if using `@import` statements

## Performance

- Type regeneration: ~5-10ms for typical themes
- No impact on HMR performance
- Efficient file watching via Vite's native watcher
- Incremental updates (only regenerates on CSS changes)

## Comparison: Runtime vs. Build-Time Resolution

### Without Plugin (Runtime Resolution)

```typescript
// Async call on every app load
const { theme } = await resolveTheme({ filePath: './styles.css' });
const color = theme.colors.primary; // Generic types
```

### With Plugin (Build-Time Generation)

```typescript
// Sync import, generated at build time

import { base } from './generated/tailwindcss/themes';

const color = base.colors.primary[500]; // Exact literal type
```

## Best Practices

1. **Enable `generateRuntime: true`** for production builds to avoid async calls
2. **Commit generated files** for team projects (like Prisma Client)
3. **Use exact output directory** in your `tsconfig.json` includes
4. **Organize theme CSS** by namespace for easier maintenance

## Advanced Configuration

### Disable Import Resolution

```typescript
tailwindResolver({
  input: 'src/styles.css',
  resolveImports: false, // Don't process @import statements
});
```

### Disable Tailwind Defaults

```typescript
tailwindResolver({
  input: 'src/styles.css',
  includeTailwindDefaults: false, // Don't include Tailwind CSS defaults
});
```

### Granular Runtime Control

```typescript
// Production build: minimal bundle size
tailwindResolver({
  input: 'src/styles.css',
  generateRuntime: {
    variants: true, // Need theme data
    selectors: true, // Need selectors for dynamic switching
    files: false, // Skip debug data
    variables: false, // Skip debug data
  },
});

// Development: include everything for debugging
tailwindResolver({
  input: 'src/styles.css',
  generateRuntime: true, // All fields included
});

// Types only (no runtime bundle)
tailwindResolver({
  input: 'src/styles.css',
  generateRuntime: false, // Only generate types.ts
});
```

## Examples

See the [main README](../../../README.md) for more detailed examples and API documentation.

## Requirements

- Vite >= 5.0
- TypeScript >= 5.0
- Node.js >= 18 or Bun >= 1.0
